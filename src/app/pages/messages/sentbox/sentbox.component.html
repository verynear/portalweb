<app-loading message="Loading..." *ngIf="loading"></app-loading>

<div id="marginFix">

<ngb-pagination *ngIf="!loading" [collectionSize]="totalItems" [pageSize]="itemsPerPage" [(page)]="page" [maxSize]="3" (pageChange)="pageChange()" class="float-right"></ngb-pagination>

<section class="sentbox" *ngIf="!loading">
	<div class="table">
	 	<table appSortableTable class="table table-hover" (sorted)="onSorted($event)">
			<thead class="thead-light">
					 <th class="width-25"> 
						<app-th disable="true">
							<p-checkbox name="groupname" value="val2" [(ngModel)]="checkAll" binary="true" (click)="selectAllMessages(checkAll)"></p-checkbox>
						</app-th>
					</th>
					 <th class="width-250">
						<app-th columnName="id" displayName="Recipient"></app-th>
					</th> 
					<th class="width-100">
					</th>
					<th class="min-width-100">
						<app-th columnName="message" displayName="Message"></app-th>
					</th>
					<th class="text-right" style="padding-left:50px;">
						<app-th columnName="createDate" displayName="Date"></app-th>
					</th> 
			<tbody *ngIf="messages?.length; else no_data_templ"> 
				<tr *ngFor='let message of messages' (click)="openMessage(message.id)">
					<td>
						<ul class="list-inline m-0">
						  <li class="list-inline-item">
							<p-checkbox name="groupname" value="val2" [(ngModel)]="message.selected" binary="true"></p-checkbox>
						  </li>
						</ul>
					</td>

					<td class="ellipsis">
		
						<span *ngIf="message.type ==='SITE'">
							{{message.messageRecipients[0]?.rentalSite}}		
						</span>

						<span *ngIf="message.type === 'BUILDING'">
							Building - {{message.messageRecipients[0]?.rentalSiteBuilding}}
						</span>

						<span *ngIf="message.type === 'UNIT'">
							{{message.messageRecipients[0]?.rentalSiteBuilding}}:
							Units -
							<span *ngFor='let isLast=last; let message of message.messageRecipients | filterUnits'>
							    {{message}}{{isLast ? '' : ', '}}
						    </span>
						</span>

						<span *ngIf="message.type === 'RESIDENT'">
							{{message.messageRecipients[0]?.rentalSiteBuilding}}
								-
							<span *ngFor='let message of message.messageRecipients; let isLast=last'>
								{{message.lastname}}{{isLast ? '' : ', '}}
							</span>
						</span>
					</td>
					<td>
						<button [ngClass]="message.type" class="btn sentType UNIT">
							<span *ngIf="message.type==='SITE'">
								Community
							</span>
							<span *ngIf="message.type!='SITE'">
								{{message.type}}
							</span>
						</button>
					</td>

					<td class="min-width-100" style="padding-right: 20px">
		
						<span class="previewTitle"> {{message.subject}} -</span> 
						<span class="previewSubject" [innerHTML]="message.message | htmlToPlain"> </span> 
					</td>
					<td class="text-right" style="padding-left: 50px">
						<i *ngIf="message.messageAttachments.length" class="fa fa-paperclip fa-lg"></i>
						<button class="btn sentType report" (click)="openReport(message.id)">
					       <i class="fa fa-tasks"></i>
					    </button>
					    <i style="color: #fff" class="fa fa-angle-right"></i>
						<span>{{message.createDate | date: 'MMM dd, y' }} </span>
					</td>
				</tr>				               
			</tbody>
		</table>
	</div>
</section>      

<ngb-pagination *ngIf="!loading" [collectionSize]="totalItems" [pageSize]="itemsPerPage" [(page)]="page" [maxSize]="3" (pageChange)="pageChange()" class="float-right"></ngb-pagination>

</div>
<!-- if no messages are loaded, use this placeholder -->
<ng-template #no_data_templ>
	        <tbody>
				<tr>
					<td>
						<ul class="list-inline m-0">
						  <li class="list-inline-item">
							<p-checkbox name="groupname" value="val2" binary="true"></p-checkbox>
						  </li>
						</ul>
					</td>
					<td class="ellipsis">
						<span>
						</span>
					</td>
					<td>
						<button  class="btn sentType UNIT">
							<span>
								Community
							</span>
						</button>
					</td>

					<td class="min-width-100" style="padding-right: 20px">
		
						<span class="previewTitle"> Empty Message -</span> 
						<span class="previewSubject"> No Messages</span> 
					</td>
					<td class="text-right" style="padding-left: 50px">
						<span> Aug 10, 1984 </span>
					</td>
				</tr>
			</tbody>			               
</ng-template>