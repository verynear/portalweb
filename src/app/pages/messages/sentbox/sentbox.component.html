<ngb-pagination *ngIf="!loading" [collectionSize]="totalItems" [pageSize]="itemsPerPage" [(page)]="page" [maxSize]="3" class="float-right"></ngb-pagination>
<!-- Mailbox -->
<section class="inbox" *ngIf="!loading">
	<div class="table table-responsive">
		<table appSortableTable class="table table-hover" (sorted)="onSorted($event)">
			<thead class="thead-light">
				<!-- CUSTOM ANGULAR4 SORT DIRECTIVES -->
					<th> 
						<input type="checkbox" [(ngModel)]="checkAll" (click)="selectAllMessages(checkAll)" name="checkbox">
					</th>
					<th class="noPadding"><app-th columnName="id" displayName="Name"></app-th></th>
					<th>
					</th>
					<th class="noPadding"><app-th columnName="message" displayName="Subject"></app-th></th>
					<th class="noPadding"><app-th columnName="createDate" displayName="Date"></app-th></th>
			</thead>
			<tbody>
				<tr *ngFor='let message of messages | slice:(page-1)*itemsPerPage:itemsPerPage*page' (click)="openMessage(message.id)">
					<td class="fixed-30">
						<ul class="list-inline m-0">
						  <li class="list-inline-item">
						    <input type="checkbox" [(ngModel)]="message.selected" name="checkbox">
						  </li>
						</ul>
					</td>
					<td class="fixed-60 nowrap"> 
						<span> To: </span>
						<span *ngFor='let recipient of message.recipients; let i=index; let isLast=last'>
							<span *ngIf="i < 3" >
								<span> {{recipient.firstname}}<span *ngIf="i < 2 && !isLast">, </span>
								</span>
							</span>
						</span>

						<!-- If we have more than 3 recipients, display "..." -->
						<span *ngIf="message.alertRecipients.length > 3">
								...
						</span>

						<span *ngIf="message.alertRecipients.length"> ({{message.alertRecipients.length}}) </span>
					</td> 
					<td class="fixed-60">
						<button [ngClass]="message.type" class="btn btn-sm btn-default previewTitle sentType">
							<!-- TODO: Move logic to component -->
							<span *ngIf="message.type==='SITE'">Community</span>
							<span *ngIf="message.type!='SITE'">{{message.type}}</span>
							<!-- End -->
						</button>
					</td>
					<td width="50%">
						<span class="previewTitle"> {{message.subject}} </span> 
						<span class="previewMessage">- {{message.message}} </span> 
					</td> 
					<td class="fixed-60 nowrap"><b>{{message.createDate | date:'short' }}</b> </td>
				</tr>				               
			</tbody>
		</table>
	</div>
</section>     

<ngb-pagination *ngIf="!loading" [collectionSize]="totalItems" [pageSize]="itemsPerPage" [(page)]="page" [maxSize]="3" class="float-right"></ngb-pagination>
              
<p-progressSpinner class="spinner" *ngIf="loading" [style]="{width: '75px', height: '75px'}" strokeWidth="8" animationDuration="1s" mode="indeterminate"></p-progressSpinner>

