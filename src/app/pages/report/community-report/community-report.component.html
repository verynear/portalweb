<div id="main">
  <div class="main-content">
    
    <app-loading *ngIf="loading" message="Loading Community Report..." ></app-loading>

    <div class="container-fluid">
      <div class="row">
        <div class="col-md-12">
          <h1>Community Report <small>{{currentSite?.name}}</small> </h1>
        </div>
      </div>

        <form>		
          <div class="row">
            <div class="col-md-3">
              <section>
                <div class="form-group">
                  <label class="sr-only" for="inlineFormInputGroup">Search</label>
                    <div class="input-group">
                    <input type="search" class="form-control form-control-sm" id="inlineFormInputGroup" placeholder="Search">
                    <div class="input-group-addon"><i class="fa fa-search"></i></div>
                  </div>
                </div>
              </section>
              <app-report-nav></app-report-nav>
            </div> 
  
            <div class="col-md-9">
              <section class="message-report">        
                <table *ngIf="!loading" class="table table table-bordered table-hover">
                    <thead>
                      <tr>
                        <th>Location</th>
                        <th>Resident</th>
                        <th>Recent Messages</th>
                        <th>Sent Date</th>
                        <th class="faMargin">Receipt</th>
                      </tr>
                    </thead>

                    <ng-container *ngFor="let building of buildingReport">
                    <tbody *ngFor="let unit of building.buildingUnit; let p = index">  
                    
                      <tr class="rowHeader" *ngIf="p==0"> 
                          <th colspan="5">{{building.address1}}</th> 
                      </tr>
                      
                      <tr *ngFor="let tenant of unit.tenants; let i = index">
                        <td *ngIf="i==0" attr.rowspan="{{unit.tenants.length}}">
                          <!-- <td> -->
                          <p> {{unit.unitNumber}} </p>
                        </td>
                        <td> {{tenant.firstname}} {{tenant.lastname}}</td>
                        <td>  
                          <ul class="list-unstyled">
                            <li *ngFor="let message of tenant.messages; let i=index">
                              <div *ngIf="i<3">
                                <a [routerLink]="" class="pointer" (click)="openMessageReport(message.id)"> {{message.subject}} </a>
                              
                                <app-attachment-list (currSize)="rowSize($event, message)" [attachments]="message.attachment"></app-attachment-list>
                              </div>
                            </li>
                          </ul> 
                        </td>
                        <td> 
                          <ul class="list-unstyled">
                            <li *ngFor="let message of tenant.messages; let i=index">
                              <div *ngIf="i<3">

                                {{message.createDate | date:'short'}} <span class="fa fa-check isRead"></span>

                                <!-- Message Attachment Report -->
                                <ul class="list-unstyled attachmentDate">
                                  <li *ngFor="let attachment of message.attachment; let i = index">
                                    <div *ngIf="i < message.rowSize">
                                      {{ attachment.createDate | date:'short' }} <span class="fa fa-check isRead"></span>
                                    </div>
                                  </li>
                                </ul>

                              </div>
                            </li>
                          </ul> 
                        </td>
                        <td>
                          <ul class="list-unstyled">
                            <li *ngFor="let message of tenant.messages; let i=index">
                              <div *ngIf="i<3">
                                
                                <div *ngIf="!message.updateDate" class="text-muted">
                                  Not Read <span class="fa fa-times text-right notRead"></span>
                                </div>
  
                                <div *ngIf="message.updateDate">
                                   {{message.updateDate | date:'short'}} <span class="fa fa-check isRead"></span>
                                </div>

                                <!-- Message Attachment Report -->
                                <ul class="list-unstyled attachmentDate">
                                    <li *ngFor="let attachment of message.attachment; let i = index">
                                      <div *ngIf="i < message.rowSize">
                                        {{ attachment.updateDate | date:'short' }} <span class="fa fa-check isRead"></span>
                                      </div>
                                    </li>
                                  </ul>
                                
                              </div>
                            </li>
                          </ul> 
                        </td>
                      </tr>
                    </tbody>
                    </ng-container>
                  </table>
              </section>
            </div>
          </div>
        </form>
    </div>
  </div>
</div>